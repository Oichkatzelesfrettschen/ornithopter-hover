[platformio]
default_envs = arduino_nano
src_dir = src
include_dir = include
lib_dir = lib
test_dir = tests

[env]
; Common settings for all environments
framework = arduino
monitor_speed = 115200
build_flags =
    -D VERSION=1.0.0
    -D ENABLE_DEBUG=1
    -Wall
    -Wextra
    -std=gnu++11
lib_deps =
    adafruit/Adafruit MPU6050@^2.2.4
    adafruit/Adafruit BMP280 Library@^2.6.6
    adafruit/Adafruit Unified Sensor@^1.1.9
    adafruit/Adafruit BusIO@^1.14.1

[env:arduino_nano]
platform = atmelavr
board = nanoatmega328
upload_speed = 57600
; Optimize for size on limited flash
build_flags =
    ${env.build_flags}
    -Os
    -D ARDUINO_NANO=1

[env:arduino_nano_debug]
extends = env:arduino_nano
build_flags =
    ${env:arduino_nano.build_flags}
    -g
    -D DEBUG_MODE=1
build_type = debug

[env:teensy40]
platform = teensy
board = teensy40
; Teensy 4.0 has much more power - optimize for speed
build_flags =
    ${env.build_flags}
    -O3
    -D TEENSY40=1
    -D USE_EKF=1
    -D USE_ADVANCED_MATH=1

[env:esp32]
platform = espressif32
board = esp32dev
; ESP32 enables WiFi telemetry
build_flags =
    ${env.build_flags}
    -O2
    -D ESP32=1
    -D ENABLE_WIFI=1
    -D ENABLE_OTA=1
lib_deps =
    ${env.lib_deps}
    WiFi

[env:native]
; Native environment for desktop testing
platform = native
build_flags =
    -std=c++11
    -D NATIVE_TEST=1
    -D UNITY_INCLUDE_DOUBLE
lib_deps =
    throwtheswitch/Unity@^2.5.2
test_framework = unity
test_build_src = yes

[env:native_coverage]
extends = env:native
build_flags =
    ${env:native.build_flags}
    --coverage
    -fprofile-arcs
    -ftest-coverage
extra_scripts = post:scripts/coverage.py
